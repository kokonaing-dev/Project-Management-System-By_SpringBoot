<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.thymeleaf.org " lang="en">

<head>
    <meta charset="utf-8"/>
    <title>Dashboard </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description"/>
    <meta content="Coderthemes" name="author"/>

    <!-- App favicon -->
    <link rel="shortcut icon" href="/images/favicon.ico">

    <!-- Theme Config Js -->
    <script src="/js/config.js"></script>

    <!-- Select2 css -->
    <link href="/libs/select2/css/select2.min.css" rel="stylesheet" type="text/css"/>

    <!-- Daterangepicker css -->
    <link rel="stylesheet" href="/libs/daterangepicker/daterangepicker.css">

    <!-- Fullcalendar css -->
    <link href="/libs/fullcalendar/main.min.css" rel="stylesheet" type="text/css"/>

    <!-- Bootstrap Touchspin css -->
    <link href="/libs/bootstrap-touchspin/jquery.bootstrap-touchspin.min.css" rel="stylesheet" type="text/css"/>

    <!-- Flatpickr Timepicker css -->
    <link href="/libs/flatpickr/flatpickr.min.css" rel="stylesheet" type="text/css"/>

    <!-- Bootstrap css -->
    <link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>

    <!-- App css -->
    <link href="/css/app.min.css" rel="stylesheet" type="text/css" id="app-style"/>

    <!-- Icons css -->
    <link href="/css/icons.min.css" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.1.0/remixicon.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.1.0/remixicon.min.css">

    <link rel="icon" href="favicon.ico" type="image/x-icon"> <!-- Favicon-->

    <!-- Include SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">


    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/gh/habibmhamadi/multi-select-tag@2.0.1/dist/css/multi-select-tag.css">
    <script src="https://cdn.jsdelivr.net/gh/habibmhamadi/multi-select-tag@2.0.1/dist/js/multi-select-tag.js"></script>

    <!--    jsGrid link and script-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid-theme.min.css"/>


    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">


    <!-- Datatables css -->
    <link href="/libs/datatables.net-bs5/css/dataTables.bootstrap5.min.css" rel="stylesheet" type="text/css"/>
    <link href="/libs/datatables.net-responsive-bs5/css/responsive.bootstrap5.min.css" rel="stylesheet"
          type="text/css"/>
    <link href="/libs/datatables.net-fixedcolumns-bs5/css/fixedColumns.bootstrap5.min.css" rel="stylesheet"
          type="text/css"/>
    <link href="/libs/datatables.net-fixedheader-bs5/css/fixedHeader.bootstrap5.min.css" rel="stylesheet"
          type="text/css"/>
    <link href="/libs/datatables.net-buttons-bs5/css/buttons.bootstrap5.min.css" rel="stylesheet" type="text/css"/>
    <link href="/libs/datatables.net-select-bs5/css/select.bootstrap5.min.css" rel="stylesheet" type="text/css"/>

    <style>
        /* CSS */
        .button-links a:hover {
            background-color: #e0e0e0;
            color: #333;
        }

        /* CSS */
        .project-row:hover {
            background-color: #318CE7; /* Change background color of the row when hovered */
        }

        /* Change color of project name to white when hovering over the row */
        .project-row:hover .project-name {
            color: white;
        }

        /* Hide button links by default */
        .button-links a {
            display: none;
        }

        /* Show button links when hovering over the table row */
        .project-row:hover .button-links a {
            display: inline-block;
        }

        /* Style for the button links */
        .button-links a {
            padding: 0.25rem 0.5rem; /* Adjust padding as needed */
            font-size: 0.75rem; /* Adjust font size as needed */
        }

        /* CSS */
        .accordion-body {
            padding: 0;
            margin-bottom: 0; /* Remove bottom margin of accordion-body */
        }

        .table {
            padding: 0;
            margin-bottom: 0; /* Remove bottom margin of table */
        }

        tbody>tr>td{
            font-weight: bold;
        }


    </style>

</head>

<body>
<!-- Begin page -->
<div class="wrapper">

    <!-- ========== Topbar Start ========== -->
    <div th:insert="~{/top-bar :: top-bar}"></div>
    <!-- ========== Topbar End ========== -->

    <!-- ========== Left Sidebar Start ========== -->
    <div th:insert="~{/leftside-menu :: leftside-menu}"></div>
    <!-- ========== Left Sidebar End ========== -->


    <!-- ============================================================== -->
    <!-- Start Page Content here -->
    <!-- ============================================================== -->

    <div class="content-page">
        <div class="content">

            <!-- Start Content-->
            <div class="container-fluid">

                <!-- Combined Modals -->
                <div class="modal fade" id="projectModal" tabindex="-1" role="dialog"
                     aria-labelledby="NewTaskModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" style="max-width: 1070px;">
                        <div class="modal-content">
                            <div class="modal-header bg-body-tertiary"
                                 style="background-color:#007bff; color: #fff; padding: 20px 30px;">
                                <h4 class="modal-title" id="NewTaskModalLabel">Create New Task</h4>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                            </div>
                            <div class="modal-body" style="background-color:#eeeef1;color: black; padding: 0 30px;">
                                <form class="p-2" id="issueForm" th:object="${issue}">

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">IssueType</label>
                                                <select class="form-select" th:field="*{issueType}">
                                                    <option th:each="issueType : ${issueTypes}"
                                                            th:value="${issueType.id}"
                                                            th:text="${issueType.issueName}"></option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Select a Project</label>
                                                <select class="form-select form-control" id="projectSelect"
                                                        name="projectId" th:field="*{project}">
                                                    <option value="" id="defaultOption" selected>Select Project</option>
                                                    <option th:each="project : ${projectList}" th:value="${project.id}"
                                                            th:text="${project.projectName}"></option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="subject" class="form-label">Subject</label>
                                        <input type="text" class="form-control" id="subject" th:field="*{subject}"
                                               placeholder="Subject">
                                    </div>

                                    <div class="mb-3">
                                        <label for="task-description" class="form-label">Description</label>
                                        <textarea class="form-control" id="task-description" rows="3"></textarea>
                                    </div>

                                    <div class="row">
                                        <!-- Left Column -->
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Status</label>
                                                <select class="form-select" th:field="*{issueStatus}">
                                                    <option th:each="issueStatus : ${issueStatuses}"
                                                            th:value="${issueStatus}" th:text="${issueStatus}"></option>
                                                </select>
                                            </div>
                                        </div>

                                        <!-- Right Column -->
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Priority</label>
                                                <select class="form-select" th:field="*{priority}">
                                                    <option th:each="priority : ${priorities}" th:value="${priority}"
                                                            th:text="${priority}"></option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <!-- Left Column -->
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Category</label>
                                                <select class="form-select" th:field="*{category}">
                                                    <option th:each="category : ${categories}" th:value="${category.id}"
                                                            th:text="${category.categoryName}"></option>
                                                </select>
                                            </div>
                                        </div>

                                        <!-- Right Column -->
                                        <div class="col-md-6 edit">
                                            <div class="mb-3">
                                                <label class="form-label">Assign To</label>
                                                <select name="users" id="userSelect" class="form-control"
                                                        multiple="multiple" th:field="*{users}">
                                                    <!-- Options will be dynamically populated -->
                                                    <!--                                                            <option th:each="user : ${usersList}" th:value="${user.id}" th:text="${user.username}"></option>-->
                                                </select>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="planStartDate" class="form-label">Plan Start Date</label>
                                                <input type="date" class="form-control" id="planStartDate"
                                                       th:field="*{planStartDate}">
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="planDueDate" class="form-label">Plan Due Date</label>
                                                <input type="date" class="form-control" id="planDueDate"
                                                       th:field="*{planDueDate}">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="actualStartDate" class="form-label">Actual Start
                                                    Date</label>
                                                <input type="date" class="form-control" id="actualStartDate"
                                                       th:field="*{actualStartDate}">
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="actualEndDate" class="form-label">Actual End Date</label>
                                                <input type="date" class="form-control" id="actualEndDate"
                                                       th:field="*{actualEndDate}">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="attachments" class="form-label">Attachments</label>
                                        <input type="file" class="form-control" id="attachments" name="attachments"
                                               multiple>
                                    </div>

                                    <div class="text-end">
                                        <button type="reset" class="btn btn-light" data-bs-dismiss="modal"
                                                onclick="reloadPage()">Cancel
                                        </button>
                                        <button type="submit" id="createIssueBtn" class="btn btn-primary">Create
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal-dialog -->
                </div><!-- /.modal -->


                <!-- Include jQuery library -->
                <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
                <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>


                <script>
                    $(document).ready(function () {
                        $('#projectSelect').change(function () {
                            var projectId = $(this).val(); // Get the selected project id

                            // Make an AJAX request to fetch users associated with the selected project
                            $.ajax({
                                type: 'GET',
                                url: '/user/fetch_users?projectId=' + projectId, // Correct endpoint for fetching users associated with the project
                                success: function (users) {
                                    // Clear the options of the userSelect select element
                                    $('#userSelect').empty();

                                    // Add the retrieved users as options to the userSelect select element
                                    $.each(users, function (userId, username) {
                                        $('#userSelect').append('<option value="' + userId + '">' + username + '</option>');
                                    });
                                },
                                error: function (xhr, status, error) {
                                    console.error('Error fetching users:', error);
                                }
                            });
                        });
                    });

                </script>

                <div class="row">
                    <div class="col-12">
                        <div class="page-title-box justify-content-between d-flex align-items-lg-center flex-lg-row flex-column">
                            <h4 class="page-title">Dashboard</h4>
                            <form class="d-flex mb-xxl-0 mb-2">
                                <div class="input-group">
                                    <input type="text" class="form-control shadow border-0" id="dash-daterange">
                                    <span class="input-group-text bg-primary border-primary text-white">
                                                <i class="ri-calendar-todo-fill fs-13"></i>
                                            </span>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-xl-4">
                        <div class="row justify-content-end">
                            <div class="col-5 mb-3">
                                <div class="input-group">
                                    <input type="text" id="projectSearchInput" class="form-control"
                                           placeholder="Search projects" aria-label="Search projects"
                                           aria-describedby="searchIcon">
                                    <span class="input-group-text" id="searchIcon">
                                                <i class="bi bi-search"></i>
                                        <!-- Assuming you're using Bootstrap icons -->
                                            </span>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h3 class="header-title">Projects</h3>
                                        </div>
                                        <div class="mb-2 p-0"
                                             th:if="${#authorization.expression('hasRole(''ROLE_SYSTEM_ADMIN'') or hasRole(''ROLE_PROJECT_MANAGER'')')}">
                                            <button type="button" class="btn btn-sm btn-soft-info rounded-pill"
                                                    data-bs-toggle="modal" data-bs-target="#createproject">
                                                        <span class="text-bg-info rounded rounded-3 shadow">
                                                            <i class="ri-add-circle-fill" style="font-size: 18px;"></i>
                                                        </span>
                                            </button>
                                        </div>
                                    </div>

<!--<<<<<<< HEAD
&lt;!&ndash;                            <script>&ndash;&gt;
&lt;!&ndash;                                $(function() {&ndash;&gt;
&lt;!&ndash;                                    $("#jsGrid").jsGrid({&ndash;&gt;
&lt;!&ndash;                                        width: "100%",&ndash;&gt;
&lt;!&ndash;                                        height: "auto",&ndash;&gt;

&lt;!&ndash;                                        // Configure your fields here&ndash;&gt;
&lt;!&ndash;                                        fields: [&ndash;&gt;
&lt;!&ndash;                                            { name: "id", type: "text", title: "ID" },&ndash;&gt;
&lt;!&ndash;                                            { name: "subject", type: "text", title: "Subject" },&ndash;&gt;
&lt;!&ndash;                                            { name: "description", type: "text", title: "Description" },&ndash;&gt;
&lt;!&ndash;                                            { name: "issueType.issueName", type: "text", title: "Issue Type" },&ndash;&gt;
&lt;!&ndash;                                            { name: "category.categoryName", type: "text", title: "Category" },&ndash;&gt;
&lt;!&ndash;                                            { name: "project.projectName", type: "text", title: "Project" },&ndash;&gt;
&lt;!&ndash;                                            { name: "issueStatus", type: "text", title: "Issue Status" },&ndash;&gt;
&lt;!&ndash;                                            { name: "priority", type: "text", title: "Priority" },&ndash;&gt;
&lt;!&ndash;                                            { name: "planStartDate", type: "text", title: "Plan Start Date" },&ndash;&gt;
&lt;!&ndash;                                            { name: "planDueDate", type: "text", title: "Plan Due Date" },&ndash;&gt;
&lt;!&ndash;                                            { name: "actualStartDate", type: "text", title: "Actual Start Date" },&ndash;&gt;
&lt;!&ndash;                                            { name: "actualEndDate", type: "text", title: "Actual End Date" },&ndash;&gt;
&lt;!&ndash;                                            // Add other fields as needed&ndash;&gt;
&lt;!&ndash;                                        ],&ndash;&gt;

&lt;!&ndash;                                        // Load data dynamically&ndash;&gt;
&lt;!&ndash;                                        data: [],&ndash;&gt;

&lt;!&ndash;                                        // Configure sorting and paging if needed&ndash;&gt;
&lt;!&ndash;                                        sorting: true,&ndash;&gt;
&lt;!&ndash;                                        paging: true,&ndash;&gt;

&lt;!&ndash;                                        // Configure custom controllers for searching&ndash;&gt;
&lt;!&ndash;                                        controller: {&ndash;&gt;
&lt;!&ndash;                                            loadData: function(filter) {&ndash;&gt;
&lt;!&ndash;                                                // Implement loading data based on filter parameters&ndash;&gt;
&lt;!&ndash;                                                // You can make an AJAX call here to fetch data based on search criteria&ndash;&gt;
&lt;!&ndash;                                                return $.ajax({&ndash;&gt;
&lt;!&ndash;                                                    type: "GET",&ndash;&gt;
&lt;!&ndash;                                                    url: "/api/issues/filtered", // Your endpoint for fetching filtered data&ndash;&gt;
&lt;!&ndash;                                                    data: filter // Pass the filter parameters to the backend&ndash;&gt;
&lt;!&ndash;                                                });&ndash;&gt;
&lt;!&ndash;                                            }&ndash;&gt;
&lt;!&ndash;                                        }&ndash;&gt;
&lt;!&ndash;                                    });&ndash;&gt;
&lt;!&ndash;                                });&ndash;&gt;
&lt;!&ndash;                            </script>&ndash;&gt;




                            <script>
                                $(document).ready(function () {
                                    // Populate the Issue Type dropdown
                                    fetchIssueTypes();

                                    // Populate the Issue Category dropdown
                                    fetchIssueCategories();

                                    // Populate the Project dropdown
                                    fetchActiveProjects()
                                });

                                // Function to fetch Issue Types and populate the dropdown
                                function fetchIssueTypes() {
                                    $.ajax({
                                        url: '/api/issue-types',
                                        type: 'GET',
                                        success: function(issueTypes) {
                                            var select = $('#searchIssueType');
                                            select.empty();
                                            select.append('<option value="">Select Issue Type</option>');
                                            // Populate the dropdown with fetched Issue Types
                                            issueTypes.forEach(function(issueType) {
                                                select.append('<option value="' + issueType.id + '">' + issueType.issueName + '</option>');
                                            });
                                        },
                                        error: function(xhr, status, error) {
                                            console.error('Error fetching Issue Types:', error);
                                        }
                                    });
                                }

                                // Function to fetch Issue Categories and populate the dropdown
                                function fetchIssueCategories() {
                                    $.ajax({
                                        url: '/api/issue-categories',
                                        type: 'GET',
                                        success: function(issueCategories) {
                                            var select = $('#searchCategory');
                                            select.empty();
                                            select.append('<option value="">Select Issue Category</option>');
                                            // Populate the dropdown with fetched Issue Categories
                                            issueCategories.forEach(function(category) {
                                                select.append('<option value="' + category.id + '">' + category.categoryName + '</option>');
                                            });
                                        },
                                        error: function(xhr, status, error) {
                                            console.error('Error fetching Issue Categories:', error);
                                        }
                                    });
                                }


                                // Function to fetch Active Projects and populate the dropdown
                                function fetchActiveProjects() {
                                    $.ajax({
                                        url: '/api/active-projects', // Endpoint for active projects
                                        type: 'GET',
                                        success: function(activeProjectsList) {
                                            var select = $('#searchProject');
                                            select.empty();
                                            select.append('<option value="">Select Project</option>');

                                            // Populate the dropdown with fetched Active Projects
                                            activeProjectsList.forEach(function(project) {
                                                select.append('<option value="' + project.id + '">' + project.projectName + '</option>');
                                            });
                                        },
                                        error: function(xhr, status, error) {
                                            console.error('Error fetching Active Projects:', error);
                                        }
                                    });
                                }

                            </script>

&lt;!&ndash;                            <div class="col-xl-12">&ndash;&gt;
&lt;!&ndash;                                <div class="col-12">&ndash;&gt;
&lt;!&ndash;                                    <div class="card">&ndash;&gt;
&lt;!&ndash;                                        <div class="card-body">&ndash;&gt;
&lt;!&ndash;                                            <div class="row">&ndash;&gt;
&lt;!&ndash;                                                <div class="col-lg-3">&ndash;&gt;
&lt;!&ndash;                                                    <div class="d-grid">&ndash;&gt;
&lt;!&ndash;                                                        <button class="btn btn-lg fs-16 btn-danger" id="btn-new-event">&ndash;&gt;
&lt;!&ndash;                                                            <i class="ri-add-circle-fill"></i> Create New Event&ndash;&gt;
&lt;!&ndash;                                                        </button>&ndash;&gt;
&lt;!&ndash;                                                    </div>&ndash;&gt;
&lt;!&ndash;                                                    <div id="external-events" class="mt-3">&ndash;&gt;
&lt;!&ndash;                                                        <p class="text-muted">Drag and drop your event or click in the calendar</p>&ndash;&gt;
&lt;!&ndash;                                                        <div class="external-event bg-success-subtle text-success" data-class="bg-success"><i class="ri-focus-fill me-2 vertical-middle"></i>New Theme Release</div>&ndash;&gt;
&lt;!&ndash;                                                        <div class="external-event bg-info-subtle text-info" data-class="bg-info"><i class="ri-focus-fill me-2 vertical-middle"></i>My Event</div>&ndash;&gt;
&lt;!&ndash;                                                        <div class="external-event bg-warning-subtle text-warning" data-class="bg-warning"><i class="ri-focus-fill me-2 vertical-middle"></i>Meet manager</div>&ndash;&gt;
&lt;!&ndash;                                                        <div class="external-event bg-danger-subtle text-danger" data-class="bg-danger"><i class="ri-focus-fill me-2 vertical-middle"></i>Create New theme</div>&ndash;&gt;
&lt;!&ndash;                                                    </div>&ndash;&gt;

&lt;!&ndash;                                                </div> &lt;!&ndash; end col&ndash;&gt;&ndash;&gt;

&lt;!&ndash;                                                <div class="col-lg-9">&ndash;&gt;
&lt;!&ndash;                                                    <div class="mt-4 mt-lg-0">&ndash;&gt;
&lt;!&ndash;                                                        <div id="calendar"></div>&ndash;&gt;
&lt;!&ndash;                                                    </div>&ndash;&gt;
&lt;!&ndash;                                                </div> &lt;!&ndash; end col &ndash;&gt;&ndash;&gt;

&lt;!&ndash;                                            </div> &lt;!&ndash; end row &ndash;&gt;&ndash;&gt;
&lt;!&ndash;                                        </div> &lt;!&ndash; end card body&ndash;&gt;&ndash;&gt;
&lt;!&ndash;                                    </div> &lt;!&ndash; end card &ndash;&gt;&ndash;&gt;

&lt;!&ndash;                                    &lt;!&ndash; Add New Event MODAL &ndash;&gt;&ndash;&gt;
&lt;!&ndash;                                    <div class="modal fade" id="event-modal" tabindex="-1">&ndash;&gt;
&lt;!&ndash;                                        <div class="modal-dialog">&ndash;&gt;
&lt;!&ndash;                                            <div class="modal-content">&ndash;&gt;
&lt;!&ndash;                                                <form class="needs-validation" name="event-form" id="form-event" novalidate>&ndash;&gt;
&lt;!&ndash;                                                    <div class="modal-header py-3 px-4 border-bottom-0">&ndash;&gt;
&lt;!&ndash;                                                        <h5 class="modal-title" id="modal-title">Event</h5>&ndash;&gt;
&lt;!&ndash;                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>&ndash;&gt;
&lt;!&ndash;                                                    </div>&ndash;&gt;
&lt;!&ndash;                                                    <div class="modal-body px-4 pb-4 pt-0">&ndash;&gt;
&lt;!&ndash;                                                        <div class="row">&ndash;&gt;
&lt;!&ndash;                                                            <div class="col-12">&ndash;&gt;
&lt;!&ndash;                                                                <div class="mb-3">&ndash;&gt;
&lt;!&ndash;                                                                    <label class="control-label form-label">Event Name</label>&ndash;&gt;
&lt;!&ndash;                                                                    <input class="form-control" placeholder="Insert Event Name" type="text" name="title" id="event-title" required />&ndash;&gt;
&lt;!&ndash;                                                                    <div class="invalid-feedback">Please provide a valid event name</div>&ndash;&gt;
&lt;!&ndash;                                                                </div>&ndash;&gt;
&lt;!&ndash;                                                            </div>&ndash;&gt;
&lt;!&ndash;                                                            <div class="col-12">&ndash;&gt;
&lt;!&ndash;                                                                <div class="mb-3">&ndash;&gt;
&lt;!&ndash;                                                                    <label class="control-label form-label">Category</label>&ndash;&gt;
&lt;!&ndash;                                                                    <select class="form-select" name="category" id="event-category" required>&ndash;&gt;
&lt;!&ndash;                                                                        <option value="bg-danger" selected>Danger</option>&ndash;&gt;
&lt;!&ndash;                                                                        <option value="bg-success">Success</option>&ndash;&gt;
&lt;!&ndash;                                                                        <option value="bg-primary">Primary</option>&ndash;&gt;
&lt;!&ndash;                                                                        <option value="bg-info">Info</option>&ndash;&gt;
&lt;!&ndash;                                                                        <option value="bg-dark">Dark</option>&ndash;&gt;
&lt;!&ndash;                                                                        <option value="bg-warning">Warning</option>&ndash;&gt;
&lt;!&ndash;                                                                    </select>&ndash;&gt;
&lt;!&ndash;                                                                    <div class="invalid-feedback">Please select a valid event category</div>&ndash;&gt;
&lt;!&ndash;                                                                </div>&ndash;&gt;
&lt;!&ndash;                                                            </div>&ndash;&gt;
&lt;!&ndash;                                                        </div>&ndash;&gt;
&lt;!&ndash;                                                        <div class="row">&ndash;&gt;
&lt;!&ndash;                                                            <div class="col-6">&ndash;&gt;
&lt;!&ndash;                                                                <button type="button" class="btn btn-danger" id="btn-delete-event">Delete</button>&ndash;&gt;
&lt;!&ndash;                                                            </div>&ndash;&gt;
&lt;!&ndash;                                                            <div class="col-6 text-end">&ndash;&gt;
&lt;!&ndash;                                                                <button type="button" class="btn btn-light me-1" data-bs-dismiss="modal">Close</button>&ndash;&gt;
&lt;!&ndash;                                                                <button type="submit" class="btn btn-success" id="btn-save-event">Save</button>&ndash;&gt;
&lt;!&ndash;                                                            </div>&ndash;&gt;
&lt;!&ndash;                                                        </div>&ndash;&gt;
&lt;!&ndash;                                                    </div>&ndash;&gt;
&lt;!&ndash;                                                </form>&ndash;&gt;
&lt;!&ndash;                                            </div> &lt;!&ndash; end modal-content&ndash;&gt;&ndash;&gt;
&lt;!&ndash;                                        </div> &lt;!&ndash; end modal dialog&ndash;&gt;&ndash;&gt;
&lt;!&ndash;                                    </div>&ndash;&gt;
&lt;!&ndash;                                    &lt;!&ndash; end modal&ndash;&gt;&ndash;&gt;
&lt;!&ndash;                                </div>&ndash;&gt;
&lt;!&ndash;                                &lt;!&ndash; end col-12 &ndash;&gt;&ndash;&gt;
&lt;!&ndash;                            </div> &lt;!&ndash; end col &ndash;&gt;&ndash;&gt;
=======-->
                                    <div class="accordion" id="accordionPanelsStayOpenExample">
                                        <div class="accordion-item">
                                            <h2 class="accordion-header" id="panelsStayOpen-headingOne">
                                                <button class="accordion-button fw-medium" type="button"
                                                        data-bs-toggle="collapse"
                                                        data-bs-target="#panelsStayOpen-collapseOne"
                                                        aria-expanded="true"
                                                        aria-controls="panelsStayOpen-collapseOne">
                                                    Projects List
                                                </button>
                                            </h2>
                                            <div id="panelsStayOpen-collapseOne"
                                                 class="accordion-collapse collapse show"
                                                 aria-labelledby="panelsStayOpen-headingOne">
                                                <div class="accordion-body">
                                                    <table class="table">
                                                        <tbody id="projectTableBody">
                                                        <!-- Iterate over projects -->
                                                        <tr th:each="project : ${projects}" class="project-row"
                                                            th:attr="data-project-id=${project.id}"
                                                            onclick="redirectToHomePage(this)">
                                                            <!-- Project name column -->
                                                            <td th:text="${project.projectName}"
                                                                class="project-name"></td>
                                                            <!-- Button links column -->
<!--                                                            <td class="button-links">-->
<!--                                                                &lt;!&ndash;                                                                    <a class="btn btn-sm btn-primary add-issue-btn" th:attr="data-project-id=${project.id}">Add Issue</a>&ndash;&gt;-->
<!--                                                                <a class="btn btn-sm btn-primary add-issue-btn" href="#"-->
<!--                                                                   th:attr="data-project-id=${project.id}"-->
<!--                                                                   onclick="redirectToMainPage(this)">Add Issue</a>-->
<!--                                                                <a href="#"-->
<!--                                                                   class="btn btn-sm btn-secondary show-issues-btn"-->
<!--                                                                   th:attr="data-project-id=${project.id}">Issues</a>-->
<!--                                                                <a href="#" class="btn btn-sm btn-info">Board</a>-->
<!--                                                            </td>-->
                                                            <td class="button-links">
                                                                <a href="#" class="btn btn-danger btn-delete-project">
                                                                    <i class="ri-close-line"></i>
                                                                </a>
                                                            </td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div> <!-- end card-body-->
                            </div> <!-- end card-->

                        </div>
                    </div> <!-- end col-->

                    <div class="col-xl-8 mb-5">
                        <!-- Search issue type, category, and project input fields -->
                        <div class="row mb-3">
                            <div class="col-md-3 d-flex justify-content-end">
                                <!--  --Start for tasks ----- -->
                                <!-- Check if the user has ROLE_SYSTEM_ADMIN role-->
<!--                                <button class="btn btn-soft-success"-->
<!--                                        th:if="${#authorization.expression('hasAnyRole(''ROLE_SYSTEM_ADMIN'', ''ROLE_PROJECT_MANAGER'')')}">-->
<!--                                    <a th:unless="${#authorization.expression('hasAuthority(''ROLE_MEMBER'')')}"-->
<!--                                       href="#" data-bs-toggle="modal" data-bs-target="#projectModal" class="nav-link">-->
<!--                                        <i class="ri-add-circle-fill"></i>-->
<!--                                        <span>Add Issue </span>-->
<!--                                    </a>-->
<!--                                </button>-->
                            </div>
<!--                            <div class="col-md-3">-->
<!--                                <select class="form-select" id="searchIssueType">-->
<!--                                    <option value="">Select Issue Type</option>-->
<!--                                    &lt;!&ndash; Issue Type options will be dynamically populated using JavaScript &ndash;&gt;-->
<!--                                </select>-->
<!--                            </div>-->
<!--                            <div class="col-md-3">-->
<!--                                <select class="form-select" id="searchCategory">-->
<!--                                    <option value="">Select Issue Category</option>-->
<!--                                    &lt;!&ndash; Issue category options will be dynamically populated using JavaScript &ndash;&gt;-->
<!--                                </select>-->
<!--                            </div>-->
<!--                            <div class="col-md-3">-->
<!--                                <select class="form-select" id="searchProject">-->
<!--                                    <option value="">Select Project</option>-->
<!--                                    &lt;!&ndash; Project options will be dynamically populated using JavaScript &ndash;&gt;-->
<!--                                </select>-->
<!--                            </div>-->
                        </div>

                        <div class="row">
                            <div class="col-12">
                                <div class="table-responsive">
                                    <table id="issueTable" class="table table-bordered border-5 table-striped">
                                        <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Project Name</th>
                                            <th>Subject</th>
                                            <th>Description</th>
                                            <th>Issue Type</th>
                                            <th>Category</th>
                                            <th>Issue Status</th>
                                            <th>Priority</th>
                                            <th>Plan Start Date</th>
                                            <th>Plan Due Date</th>
                                            <th>Actual Start Date</th>
                                            <th>Actual End Date</th>

                                            <!-- Add more headers for other fields as needed -->
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <!-- Iterate over each issue and populate the table rows -->
                                        <tr th:each="issue : ${issues}">
                                            <td th:text="${issue.id}"></td>
                                            <td th:text="${issue.project.projectName}"></td>
                                            <td th:text="${issue.subject}"></td>
                                            <td th:text="${issue.description}"></td>
<!--                                            <td th:text="${issue.issueType.issueName}"></td>-->
                                            <td th:text="${issue.category.categoryName}"></td>
                                            <td th:text="${issue.issueStatus}"></td>
<!--                                            <td>-->
<!--                                                <span class="badge bg-primary" th:text="${issue.issueStatus}"></span>-->
<!--                                            </td>-->

<!--                                            <td>-->
<!--                                                <span th:text="${issue.issueStatus}" class="badge badge-"-->
<!--                                                      th:classappend="${issue.issueStatus == 'OPEN' ? 'primary' :-->
<!--                                                                       (issue.issueStatus == 'IN_PROGRESS' ? 'warning' :-->
<!--                                                                       (issue.issueStatus == 'CLOSED' ? 'success' : 'secondary'))}">-->
<!--                                                </span>-->
<!--                                            </td>-->

                                            <td th:text="${issue.priority}"></td>
                                            <td th:text="${issue.planStartDate}"></td>
                                            <td th:text="${issue.planDueDate}"></td>
                                            <td th:text="${issue.actualStartDate}"></td>
                                            <td th:text="${issue.actualEndDate}"></td>
                                            <!-- Add more columns for other fields as needed -->
                                        </tr>
                                        </tbody>
                                    </table>
                                    <script>
                                        $(document).ready(function () {
                                            $('#issueTable').DataTable();
                                        });
                                    </script>
                                </div>
                            </div>
                        </div>
                    </div>

                    <script>
                        $(document).ready(function () {
                            // Populate the Issue Type dropdown
                            fetchIssueTypes();

                            // Populate the Issue Category dropdown
                            fetchIssueCategories();

                            // Populate the Project dropdown
                            fetchActiveProjects()
                        });

                        // Function to fetch Issue Types and populate the dropdown
                        function fetchIssueTypes() {
                            $.ajax({
                                url: '/api/issue-types',
                                type: 'GET',
                                success: function (issueTypes) {
                                    var select = $('#searchIssueType');
                                    select.empty();
                                    select.append('<option value="">Select Issue Type</option>');
                                    // Populate the dropdown with fetched Issue Types
                                    issueTypes.forEach(function (issueType) {
                                        select.append('<option value="' + issueType.id + '">' + issueType.issueName + '</option>');
                                    });
                                },
                                error: function (xhr, status, error) {
                                    console.error('Error fetching Issue Types:', error);
                                }
                            });
                        }

                        // Function to fetch Issue Categories and populate the dropdown
                        function fetchIssueCategories() {
                            $.ajax({
                                url: '/api/issue-categories',
                                type: 'GET',
                                success: function (issueCategories) {
                                    var select = $('#searchCategory');
                                    select.empty();
                                    select.append('<option value="">Select Issue Category</option>');
                                    // Populate the dropdown with fetched Issue Categories
                                    issueCategories.forEach(function (category) {
                                        select.append('<option value="' + category.id + '">' + category.categoryName + '</option>');
                                    });
                                },
                                error: function (xhr, status, error) {
                                    console.error('Error fetching Issue Categories:', error);
                                }
                            });
                        }


                        // Function to fetch Active Projects and populate the dropdown
                        function fetchActiveProjects() {
                            $.ajax({
                                url: '/api/active-projects', // Endpoint for active projects
                                type: 'GET',
                                success: function (activeProjectsList) {
                                    var select = $('#searchProject');
                                    select.empty();
                                    select.append('<option value="">Select Project</option>');

                                    // Populate the dropdown with fetched Active Projects
                                    activeProjectsList.forEach(function (project) {
                                        select.append('<option value="' + project.id + '">' + project.projectName + '</option>');
                                    });
                                },
                                error: function (xhr, status, error) {
                                    console.error('Error fetching Active Projects:', error);
                                }
                            });
                        }

                    </script>

<!--                    <div class="col-xl-12">-->
<!--                        <div class="col-12">-->
<!--                            <div class="card">-->
<!--                                <div class="card-body">-->
<!--                                    <div class="row">-->
<!--                                        <div class="col-lg-3">-->
<!--                                            <div class="d-grid">-->
<!--                                                <button class="btn btn-lg fs-16 btn-danger" id="btn-new-event">-->
<!--                                                    <i class="ri-add-circle-fill"></i> Create New Event-->
<!--                                                </button>-->
<!--                                            </div>-->
<!--                                            <div id="external-events" class="mt-3">-->
<!--                                                <p class="text-muted">Drag and drop your event or click in the-->
<!--                                                    calendar</p>-->
<!--                                                <div class="external-event bg-success-subtle text-success"-->
<!--                                                     data-class="bg-success"><i-->
<!--                                                        class="ri-focus-fill me-2 vertical-middle"></i>New Theme Release-->
<!--                                                </div>-->
<!--                                                <div class="external-event bg-info-subtle text-info"-->
<!--                                                     data-class="bg-info"><i-->
<!--                                                        class="ri-focus-fill me-2 vertical-middle"></i>My Event-->
<!--                                                </div>-->
<!--                                                <div class="external-event bg-warning-subtle text-warning"-->
<!--                                                     data-class="bg-warning"><i-->
<!--                                                        class="ri-focus-fill me-2 vertical-middle"></i>Meet manager-->
<!--                                                </div>-->
<!--                                                <div class="external-event bg-danger-subtle text-danger"-->
<!--                                                     data-class="bg-danger"><i-->
<!--                                                        class="ri-focus-fill me-2 vertical-middle"></i>Create New theme-->
<!--                                                </div>-->
<!--                                            </div>-->

<!--                                        </div> &lt;!&ndash; end col&ndash;&gt;-->

<!--                                        <div class="col-lg-9">-->
<!--                                            <div class="mt-4 mt-lg-0">-->
<!--                                                <div id="calendar"></div>-->
<!--                                            </div>-->
<!--                                        </div> &lt;!&ndash; end col &ndash;&gt;-->

<!--                                    </div> &lt;!&ndash; end row &ndash;&gt;-->
<!--                                </div> &lt;!&ndash; end card body&ndash;&gt;-->
<!--                            </div> &lt;!&ndash; end card &ndash;&gt;-->

<!--                            &lt;!&ndash; Add New Event MODAL &ndash;&gt;-->
<!--                            <div class="modal fade" id="event-modal" tabindex="-1">-->
<!--                                <div class="modal-dialog">-->
<!--                                    <div class="modal-content">-->
<!--                                        <form class="needs-validation" name="event-form" id="form-event" novalidate>-->
<!--                                            <div class="modal-header py-3 px-4 border-bottom-0">-->
<!--                                                <h5 class="modal-title" id="modal-title">Event</h5>-->
<!--                                                <button type="button" class="btn-close" data-bs-dismiss="modal"-->
<!--                                                        aria-label="Close"></button>-->
<!--                                            </div>-->
<!--                                            <div class="modal-body px-4 pb-4 pt-0">-->
<!--                                                <div class="row">-->
<!--                                                    <div class="col-12">-->
<!--                                                        <div class="mb-3">-->
<!--                                                            <label class="control-label form-label">Event Name</label>-->
<!--                                                            <input class="form-control" placeholder="Insert Event Name"-->
<!--                                                                   type="text" name="title" id="event-title" required/>-->
<!--                                                            <div class="invalid-feedback">Please provide a valid event-->
<!--                                                                name-->
<!--                                                            </div>-->
<!--                                                        </div>-->
<!--                                                    </div>-->
<!--                                                    <div class="col-12">-->
<!--                                                        <div class="mb-3">-->
<!--                                                            <label class="control-label form-label">Category</label>-->
<!--                                                            <select class="form-select" name="category"-->
<!--                                                                    id="event-category" required>-->
<!--                                                                <option value="bg-danger" selected>Danger</option>-->
<!--                                                                <option value="bg-success">Success</option>-->
<!--                                                                <option value="bg-primary">Primary</option>-->
<!--                                                                <option value="bg-info">Info</option>-->
<!--                                                                <option value="bg-dark">Dark</option>-->
<!--                                                                <option value="bg-warning">Warning</option>-->
<!--                                                            </select>-->
<!--                                                            <div class="invalid-feedback">Please select a valid event-->
<!--                                                                category-->
<!--                                                            </div>-->
<!--                                                        </div>-->
<!--                                                    </div>-->
<!--                                                </div>-->
<!--                                                <div class="row">-->
<!--                                                    <div class="col-6">-->
<!--                                                        <button type="button" class="btn btn-danger"-->
<!--                                                                id="btn-delete-event">Delete-->
<!--                                                        </button>-->
<!--                                                    </div>-->
<!--                                                    <div class="col-6 text-end">-->
<!--                                                        <button type="button" class="btn btn-light me-1"-->
<!--                                                                data-bs-dismiss="modal">Close-->
<!--                                                        </button>-->
<!--                                                        <button type="submit" class="btn btn-success"-->
<!--                                                                id="btn-save-event">Save-->
<!--                                                        </button>-->
<!--                                                    </div>-->
<!--                                                </div>-->
<!--                                            </div>-->
<!--                                        </form>-->
<!--                                    </div> &lt;!&ndash; end modal-content&ndash;&gt;-->
<!--                                </div> &lt;!&ndash; end modal dialog&ndash;&gt;-->
<!--                            </div>-->
<!--                            &lt;!&ndash; end modal&ndash;&gt;-->
<!--                        </div>-->
<!--                        &lt;!&ndash; end col-12 &ndash;&gt;-->
<!--                    </div> &lt;!&ndash; end col &ndash;&gt;-->
                </div>

                <script>
                    document.addEventListener("DOMContentLoaded", function () {
                        const searchInput = document.getElementById('projectSearchInput');
                        const projectRows = document.querySelectorAll('.project-row');

                        searchInput.addEventListener('input', function () {
                            const searchTerm = searchInput.value.trim().toLowerCase();

                            projectRows.forEach(function (row) {
                                const projectName = row.querySelector('.project-name').textContent.trim().toLowerCase();
                                if (projectName.includes(searchTerm)) {
                                    row.style.display = '';
                                } else {
                                    row.style.display = 'none';
                                }
                            });
                        });
                    });
                </script>


                <!-- Create Project-->
                <div class="modal fade" id="createproject" tabindex="-1" role="dialog" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header py-3 px-4 border-bottom-0">
                                <h4 class="modal-title  fw-bold" id="createprojectlLabel"> Create Project</h4>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                                        id="closeModalBtn"></button>
                            </div>
                            <form id="createProjectForm" th:object="${project}">
                                <div class="modal-body">
                                    <div class="mb-3">
                                        <label for="projectName" class="form-label">Project Name</label>
                                        <input type="text" class="form-control" id="projectName"
                                               th:field="*{projectName}" placeholder="Enter Project Name">
                                        <div id="projectNameError" class="text-danger"></div>
                                        <!-- Error message for project name -->
                                    </div>

                                    <div class="deadline-form">
                                        <div class="row g-3 mb-3">
                                            <div class="col">
                                                <label for="projectStartDate" class="form-label">Project Start
                                                    Date</label>
                                                <input type="date" class="form-control" id="projectStartDate"
                                                       th:field="*{projectStartDate}">
                                                <div id="projectStartDateError" class="text-danger"></div>
                                                <!-- Error message for project start date -->
                                            </div>
                                            <div class="col">
                                                <label for="projectEndDate" class="form-label">Project End Date</label>
                                                <input type="date" class="form-control" id="projectEndDate"
                                                       th:field="*{projectEndDate}">
                                                <div id="projectEndDateError" class="text-danger"></div>
                                                <!-- Error message for project end date -->
                                            </div>
                                            <div id="projectDateError" class="text-danger"></div>
                                        </div>
                                        <div class="row g-3 mb-3">

                                            <div class="col-sm-12">
                                                <!-- Hidden field to carry the logged-in user's ID -->
                                                <input type="hidden" name="loggedInUserId"
                                                       th:value="${loggedInUser.id}">

                                                <label class="form-label">Task Assign Person</label>
                                                <select name="countries" id="countries" multiple="multiple">
                                                    <!--                                                                <option selected disabled>Choose Person</option>-->
                                                    <!-- Loop through projectManagersAndMembers -->
                                                    <option
                                                            th:each="user : ${projectManagersAndMembers}"
                                                            th:value="${user.id}"
                                                            th:text="${user.username} + ' - ' + '<span class=&quot;badge&quot; style=&quot;background-color: ' + (${#strings.contains(user.getAuthorities(), 'ROLE_PROJECT_MANAGER') ? 'blue' : 'green'}) + '; color: white;&quot;>' + (${#strings.contains(user.getAuthorities(), 'ROLE_PROJECT_MANAGER') ? 'Manager' : 'Member'}) + '</span>'">
                                                    </option>
                                                    <!-- Loop through members -->
                                                    <option
                                                            th:each="user : ${members}"
                                                            th:value="${user.id}"
                                                            th:text="${user.username}+ ' - ' + '<span class=&quot;badge&quot; style=&quot;background-color: ' + (${#strings.contains(user.getAuthorities(), 'ROLE_PROJECT_MANAGER') ? 'blue' : 'green'}) + '; color: white;&quot;>' + (${#strings.contains(user.getAuthorities(), 'ROLE_PROJECT_MANAGER') ? 'Manager' : 'Member'}) + '</span>'">
                                                    </option>
                                                </select>
                                                <div id="assignPersonError" class="text-danger"></div>
                                                <!-- Error message for assignee selection -->
                                                <script>
                                                    new MultiSelectTag('countries', {
                                                        rounded: true,    // default true
                                                        shadow: true,      // default false
                                                        placeholder: 'Search',  // default Search...
                                                        tagColor: {
                                                            textColor: '#327b2c',
                                                            borderColor: '#92e681',
                                                            bgColor: '#eaffe6',
                                                        },
                                                        onChange: function (values) {
                                                            console.log(values)
                                                        }
                                                    })
                                                </script>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                                            id="cancelBtn">Cancel
                                    </button>
                                    <button type="submit" class="btn btn-primary">Create</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>


            </div>
            <!-- container -->

        </div>
        <!-- content -->

        <!-- Footer Start -->
        <footer class="footer">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-6">
                        <script>document.write(new Date().getFullYear())</script>
                        © FML -
                    </div>
                    <div class="col-md-6">
                        <div class="text-md-end footer-links d-none d-md-block">
                            <a href="javascript: void(0);">About</a>
                            <a href="javascript: void(0);">Support</a>
                            <a href="javascript: void(0);">Contact Us</a>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
        <!-- end Footer -->

    </div>

    <!-- ============================================================== -->
    <!-- End Page content -->
    <!-- ============================================================== -->

</div>
<!-- END wrapper -->


<!-- Theme Settings -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="theme-settings-offcanvas">
    <div class="d-flex align-items-center bg-primary p-3 offcanvas-header">
        <h5 class="text-white m-0">Theme Settings</h5>
        <button type="button" class="btn-close btn-close-white ms-auto" data-bs-dismiss="offcanvas"
                aria-label="Close"></button>
    </div>

    <div class="offcanvas-body p-0">
        <div data-simplebar class="h-100">
            <div class="card mb-0 p-3">
                <div class="alert alert-warning" role="alert">
                    <strong>Customize </strong> the overall color scheme, sidebar menu, etc.
                </div>

                <h5 class="mt-0 fs-16 fw-bold mb-3">Choose Layout</h5>
                <div class="d-flex flex-column gap-2">
                    <div class="form-check form-switch">
                        <input id="customizer-layout01" name="data-layout" type="checkbox" value="vertical"
                               class="form-check-input">
                        <label class="form-check-label" for="customizer-layout01">Vertical</label>
                    </div>
                    <div class="form-check form-switch">
                        <input id="customizer-layout02" name="data-layout" type="checkbox" value="horizontal"
                               class="form-check-input">
                        <label class="form-check-label" for="customizer-layout02">Horizontal</label>
                    </div>
                </div>

                <h5 class="my-3 fs-16 fw-bold">Color Scheme</h5>

                <div class="d-flex flex-column gap-2">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" name="data-bs-theme" id="layout-color-light"
                               value="light">
                        <label class="form-check-label" for="layout-color-light">Light</label>
                    </div>

                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" name="data-bs-theme" id="layout-color-dark"
                               value="dark">
                        <label class="form-check-label" for="layout-color-dark">Dark</label>
                    </div>
                </div>

                <div id="layout-width">
                    <h5 class="my-3 fs-16 fw-bold">Layout Mode</h5>

                    <div class="d-flex flex-column gap-2">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="data-layout-mode"
                                   id="layout-mode-fluid" value="fluid">
                            <label class="form-check-label" for="layout-mode-fluid">Fluid</label>
                        </div>

                        <div id="layout-boxed">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" name="data-layout-mode"
                                       id="layout-mode-boxed" value="boxed">
                                <label class="form-check-label" for="layout-mode-boxed">Boxed</label>
                            </div>
                        </div>

                        <div id="layout-detached">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" name="data-layout-mode"
                                       id="data-layout-detached" value="detached">
                                <label class="form-check-label" for="data-layout-detached">Detached</label>
                            </div>
                        </div>
                    </div>
                </div>

                <h5 class="my-3 fs-16 fw-bold">Topbar Color</h5>

                <div class="d-flex flex-column gap-2">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" name="data-topbar-color" id="topbar-color-light"
                               value="light">
                        <label class="form-check-label" for="topbar-color-light">Light</label>
                    </div>

                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" name="data-topbar-color" id="topbar-color-dark"
                               value="dark">
                        <label class="form-check-label" for="topbar-color-dark">Dark</label>
                    </div>

                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" name="data-topbar-color" id="topbar-color-brand"
                               value="brand">
                        <label class="form-check-label" for="topbar-color-brand">Brand</label>
                    </div>
                </div>

                <div>
                    <h5 class="my-3 fs-16 fw-bold">Menu Color</h5>

                    <div class="d-flex flex-column gap-2">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="data-menu-color"
                                   id="leftbar-color-light" value="light">
                            <label class="form-check-label" for="leftbar-color-light">Light</label>
                        </div>

                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="data-menu-color"
                                   id="leftbar-color-dark" value="dark">
                            <label class="form-check-label" for="leftbar-color-dark">Dark</label>
                        </div>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="data-menu-color"
                                   id="leftbar-color-brand" value="brand">
                            <label class="form-check-label" for="leftbar-color-brand">Brand</label>
                        </div>
                    </div>
                </div>

                <div id="sidebar-size">
                    <h5 class="my-3 fs-16 fw-bold">Sidebar Size</h5>

                    <div class="d-flex flex-column gap-2">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="data-sidenav-size"
                                   id="leftbar-size-default" value="default">
                            <label class="form-check-label" for="leftbar-size-default">Default</label>
                        </div>

                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="data-sidenav-size"
                                   id="leftbar-size-compact" value="compact">
                            <label class="form-check-label" for="leftbar-size-compact">Compact</label>
                        </div>

                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="data-sidenav-size"
                                   id="leftbar-size-small" value="condensed">
                            <label class="form-check-label" for="leftbar-size-small">Condensed</label>
                        </div>

                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="data-sidenav-size"
                                   id="leftbar-size-small-hover" value="sm-hover">
                            <label class="form-check-label" for="leftbar-size-small-hover">Hover View</label>
                        </div>

                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="data-sidenav-size"
                                   id="leftbar-size-full" value="full">
                            <label class="form-check-label" for="leftbar-size-full">Full Layout</label>
                        </div>

                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="data-sidenav-size"
                                   id="leftbar-size-fullscreen" value="fullscreen">
                            <label class="form-check-label" for="leftbar-size-fullscreen">Fullscreen Layout</label>
                        </div>
                    </div>
                </div>

                <div id="layout-position">
                    <h5 class="my-3 fs-16 fw-bold">Layout Position</h5>

                    <div class="btn-group checkbox" role="group">
                        <input type="radio" class="btn-check" name="data-layout-position" id="layout-position-fixed"
                               value="fixed">
                        <label class="btn btn-soft-primary w-sm" for="layout-position-fixed">Fixed</label>

                        <input type="radio" class="btn-check" name="data-layout-position"
                               id="layout-position-scrollable" value="scrollable">
                        <label class="btn btn-soft-primary w-sm ms-0"
                               for="layout-position-scrollable">Scrollable</label>
                    </div>
                </div>

                <div id="sidebar-user">
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <label class="fs-16 fw-bold m-0" for="sidebaruser-check">Sidebar User Info</label>
                        <div class="form-check form-switch">
                            <input type="checkbox" class="form-check-input" name="sidebar-user" id="sidebaruser-check">
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
    $('#issueForm').submit(function (e) {
        e.preventDefault(); // Prevent the default form submission
        createIssue();
    });

    function createIssue() {
        // Retrieve the project ID from the select element
        var projectId = $('#projectSelect').val();
        console.log("Project ID " + projectId);

        // Create a new FormData object
        var formData = new FormData(document.getElementById('issueForm'));

        // Add the project ID to the form data
        formData.append('projectId', projectId);

        // Add selected user IDs to form data
        const selectedUsers = document.getElementById('userSelect').selectedOptions;
        const userIds = Array.from(selectedUsers).map(option => option.value);
        formData.append('userIds', userIds.join(','));

        // Make AJAX request to save the issue
        $.ajax({
            url: '/issue/process_issue', // URL to the controller endpoint for saving issues
            method: 'POST', // HTTP method
            data: formData, // Form data
            contentType: false, // Set to false when using FormData
            processData: false, // Set to false when using FormData
            success: function (response) {
                // Handle success response
                console.log('Issue created successfully:', response);
                // Show success message using SweetAlert
                Swal.fire({
                    title: 'Success!',
                    text: 'Issue created successfully.',
                    icon: 'success',
                    confirmButtonText: 'OK'
                }).then(() => {
                    // Optionally, reload the page after successful creation
                    location.reload();
                });
            },
            error: function (xhr, status, error) {
                // Handle error
                console.error('Failed to create issue:', error);
                // Show error message using SweetAlert
                Swal.fire({
                    title: 'Error!',
                    text: 'Failed to create issue. Please try again later.',
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
            }
        });
    }

</script>


<script>

    function redirectToHomePage(row) {
        var tagName = event.target.tagName.toLowerCase();
        // Check if the clicked element is not a button link
        if (tagName !== 'a' && tagName !== 'i') {
            var projectId = row.getAttribute('data-project-id');
            /* Redirect to homepage with project id */
            window.location.href = '/homepage/' + projectId;
        }
    }

    function redirectToMainPage(button) {
        var projectId = button.getAttribute('data-project-id');
        // Redirect to the main project page with the project ID
        window.location.href = '/main-project-page/' + projectId;
    }


    document.getElementById('closeModalBtn').addEventListener('click', function () {
        // Reload the window when the modal is dismissed
        window.location.reload();
    });

    document.getElementById('cancelBtn').addEventListener('click', function () {
        // Reload the window when the modal is dismissed using Cancel button
        window.location.reload();
    });


    const validateField = (fieldValue, errorMessageElement, errorMessage) => {
        if (fieldValue === '') {
            errorMessageElement.innerText = errorMessage;
            return false;
        }
        errorMessageElement.innerText = ''; // Clear error message
        return true;
    };

    document.getElementById('createProjectForm').addEventListener('submit', function (event) {
        event.preventDefault(); // Prevent default form submission

        // Extract form data
        const formData = new FormData(this);

        // Validate project name
        const projectName = formData.get('projectName').trim();
        const projectNameValid = validateField(projectName, document.getElementById('projectNameError'), 'Project name is required');

        // Validate project start date
        const startDate = formData.get('projectStartDate').trim();
        const startDateValid = validateField(startDate, document.getElementById('projectStartDateError'), 'Project start date is required');

        // Validate project end date
        const endDate = formData.get('projectEndDate').trim();
        const endDateValid = validateField(endDate, document.getElementById('projectEndDateError'), 'Project end date is required');

        // Check if project start date is after end date
        let dateRangeValid = true;
        if (startDateValid && endDateValid && startDate !== '' && endDate !== '') {
            const startDateObj = new Date(startDate);
            const endDateObj = new Date(endDate);
            dateRangeValid = startDateObj <= endDateObj;
            document.getElementById('projectStartDateError').innerText = dateRangeValid ? '' : 'Project start date cannot be after project end date';
        }

        // Get the value of the loggedInUserId hidden field
        const loggedInUserId = formData.get('loggedInUserId');
        console.log('Logged In User ID:', loggedInUserId);
        // Append to formData
        formData.append('loggedInUserId', loggedInUserId);

        // Check if at least one assignee is selected
        const selectedUsers = document.getElementById('countries').selectedOptions;
        const assigneeValid = selectedUsers.length > 0;
        document.getElementById('assignPersonError').innerText = assigneeValid ? '' : 'At least one assignee must be selected';

        // Stop form submission if any validation fails
        if (!projectNameValid || !startDateValid || !endDateValid || !dateRangeValid || !assigneeValid) {
            return;
        }

        const userIds = Array.from(selectedUsers).map(option => option.value);
        formData.append('userIds', userIds.join(','));

        // Make POST request using Fetch API
        fetch('/project/create', {
            method: 'POST',
            body: formData
        })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(errorMessage => {
                        if (errorMessage === 'Project with the same name already exists') {
                            throw new Error('ProjectExistsError'); // Custom error for project name duplication
                        } else {
                            throw new Error(errorMessage); // Regular error handling
                        }
                    });
                }
                return response.json();
            })
            .then(data => {
                // Handle success response from the server
                console.log('Success:', data);

                // Show SweetAlert
                Swal.fire({
                    icon: 'success',
                    title: 'Project Created Successfully',
                    text: 'Your project has been created successfully!',
                    showConfirmButton: true,
                    // timer: 2000 // Close alert after 2 seconds
                }).then(() => {
                    sendNotificationToSpecificUsers(userIds);
                    //     // Reload the page after clicking OK
                    window.location.reload();
                });
            })
            .catch(error => {
                // Handle error
                console.error('Error:', error);
                if (error.message === 'ProjectExistsError') {
                    // Show specific error message for project name duplication
                    document.getElementById('projectNameError').innerText = 'Project with the same name already exists';
                } else {
                    // Show generic error message
                    error.json().then(data => {
                        document.getElementById('projectNameError').innerText = data.message || 'An error occurred';
                    }).catch(() => {
                        document.getElementById('projectNameError').innerText = 'An error occurred';
                    });
                }
                // Clear the field value after showing the error
                document.getElementById('projectName').value = '';
            });
    });


    document.addEventListener('DOMContentLoaded', function () {
        var projectBoxes = document.querySelectorAll('.project-box');

        projectBoxes.forEach(function (projectBox) {
            var startDateElement = projectBox.querySelector('.project-start-date');
            var endDateElement = projectBox.querySelector('.project-end-date');
            var dateDifferenceElement = projectBox.querySelector('.date-difference');

            // Extract start date and end date from the corresponding elements
            var startDate = new Date(startDateElement.innerText);
            var endDate = new Date(endDateElement.innerText);

            // Calculate the time difference and days difference
            var timeDiff = endDate - startDate;
            var daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));

            // Display the result in months or days
            if (daysDiff >= 30) {
                var monthsDiff = Math.floor(daysDiff / 30);
                dateDifferenceElement.innerText = monthsDiff + (monthsDiff === 1 ? ' Month' : ' Months');
            } else {
                dateDifferenceElement.innerText = daysDiff + (daysDiff === 1 ? ' Day' : ' Days');
            }
        });
    });

    function confirmDelete(projectId) {
        Swal.fire({
            title: 'Are you sure?',
            text: 'You will not be able to recover this project!',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.isConfirmed) {
                // Use template literals for string interpolation
                $.ajax({
                    url: `/projects/delete/${projectId}`, // Use template literals for dynamic URL
                    type: 'GET',
                    success: function (data) {
                        console.log('Success:', data);

                        // Show success message
                        Swal.fire({
                            icon: 'success',
                            title: 'Project Deleted Successfully',
                            text: 'Your project has been deleted successfully!',
                            showConfirmButton: true
                        }).then(() => {
                            // Optionally, remove the deleted project card from the UI
                            // $(`#project-${projectId}`).remove();
                            // Alternatively, you can reload the page after clicking OK
                            // window.location.reload();
                        });
                    },
                    error: function (xhr, status, error) {
                        console.error('Error deleting project:', error);
                        // Show error message
                        Swal.fire(
                            'Error!',
                            'Failed to delete the project.',
                            'error'
                        );
                    }
                });
            }
        });
    }

    // JavaScript to handle form submission for updating project details
    $('#updateProjectForm').submit(function (event) {
        event.preventDefault(); // Prevent default form submission

        // Get form data
        var projectId = $('#projectId').val();
        var projectName = $('#updateProjectName').val();
        var projectStartDate = $('#updateProjectStartDate').val();
        var projectEndDate = $('#updateProjectEndDate').val();

        // Ajax request to update project details
        $.ajax({
            url: '/projects/update/' + projectId,
            type: 'POST',
            data: {
                projectName: projectName,
                projectStartDate: projectStartDate,
                projectEndDate: projectEndDate
            },
            success: function (data) {
                // Handle success response
                console.log('Project updated successfully:', data);
                // Reload the page or update the project details in the UI
                window.location.reload();
            },
            error: function (xhr, status, error) {
                // Handle error response
                console.error('Error updating project:', error);
                // Display error message to the user
                alert('Error updating project. Please try again.');
            }
        });
    });


    // Assuming you have a data-project-id attribute in your HTML to identify each project
    $(".btn-delete-project").click(function () {
        var projectId = $(this).closest(".project-row").data("project-id");

        // Show SweetAlert2 confirmation dialog
        Swal.fire({
            title: "Are you sure?",
            text: "This will delete the project along with its related entities!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Yes, delete it!",
        }).then((result) => {
            if (result.isConfirmed) {
                // User confirmed deletion, send AJAX request
                $.ajax({
                    type: "DELETE",
                    url: "/deleteProject/" + projectId,
                    success: function () {
                        // Remove the corresponding row from the table
                        $(".project-row[data-project-id='" + projectId + "']").remove();
                        // Show success message
                        Swal.fire("Deleted!", "The project has been deleted.", "success");
                    },
                    error: function (xhr, status, error) {
                        console.error("Error deleting project:", error);
                        // Show error message
                        Swal.fire("Error", "Failed to delete the project. Please try again later.", "error");
                    },
                });
            }
        });
    });


</script>


<!-- Vendor js -->
<script src="/js/vendor.min.js"></script>

<!-- App js -->
<script src="/js/app.min.js"></script>


<!-- dragula js-->
<script src="/libs/dragula/dragula.min.js"></script>

<!-- demo js -->
<script src="/js/pages/component.dragula.js"></script>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- jQuery -->
<script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- DataTables JavaScript -->
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>


<!-- Dashboard App js -->
<script src="/js/pages/demo.dashboard.js"></script>

<!--  Select2 Plugin Js -->
<script src="/libs/select2/js/select2.min.js"></script>

<!-- Daterangepicker js -->
<script src="/libs/daterangepicker/moment.min.js"></script>
<script src="/libs/daterangepicker/daterangepicker.js"></script>

<!-- Fullcalendar js -->
<script src="/libs/fullcalendar/main.min.js"></script>

<!-- Calendar App Demo js -->
<script src="/js/pages/demo.calendar.js"></script>

<!-- Input Mask Plugin js -->
<script src="/libs/jquery-mask-plugin/jquery.mask.min.js"></script>

<!-- Bootstrap Touchspin Plugin js -->
<script src="/libs/bootstrap-touchspin/jquery.bootstrap-touchspin.min.js"></script>

<!-- Bootstrap Maxlength Plugin js -->
<script src="/libs/bootstrap-maxlength/bootstrap-maxlength.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.js"></script>

<!-- Datatables js -->
<script src="/libs/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="/libs/datatables.net-bs5/js/dataTables.bootstrap5.min.js"></script>
<script src="/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
<script src="/libs/datatables.net-responsive-bs5/js/responsive.bootstrap5.min.js"></script>
<script src="/libs/datatables.net-fixedcolumns-bs5/js/fixedColumns.bootstrap5.min.js"></script>
<script src="/libs/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js"></script>
<script src="/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
<script src="/libs/datatables.net-buttons-bs5/js/buttons.bootstrap5.min.js"></script>
<script src="/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
<script src="/libs/datatables.net-buttons/js/buttons.flash.min.js"></script>
<script src="/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
<script src="/libs/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>
<script src="/libs/datatables.net-select/js/dataTables.select.min.js"></script>

<!-- Datatable Demo Aapp js -->
<script src="/js/pages/demo.datatable-init.js"></script>

<!-- Typehead Plugin js -->
<!--        <script src="/libs/handlebars/handlebars.min.js"></script>-->
<!--        <script src="/libs/typeahead.js/typeahead.bundle.min.js"></script>-->

</body>

<!-- Mirrored from coderthemes.com/jidox/layouts/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 01 Feb 2024 20:00:39 GMT -->
</html>
